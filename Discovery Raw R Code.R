## Script to fit the model and score records

#Run this first - it tells R to expect up to 50,000 lines in a script
## you'll typically get an error if you skip this because R isn't used to handling really long scripts
options(expressions = 50000)

## read in the dataset
x <- read.csv("C:/Users/paulh/Downloads/BozemanFlights15.csv")



#Generates a function that will convert a numeric value to a bucket value
#'
#' @param cutoffs Vector of distinct numerics in ascending order
#' @param has_na Boolean indicating if non-numerics should be placed in the unspecified bucket
#'
#' @return The converter function.
#'
converter.numeric <- function(cutoffs, has_na = FALSE) {
  function(raw) {
    suppressWarnings(
      buckets <- findInterval(as.numeric(raw), cutoffs, all.inside = FALSE, rightmost.closed = TRUE, left.open = TRUE) - 1
    )
    
    buckets[buckets >= (length(cutoffs) - 1)] <- -1
    buckets[is.na(buckets)] <- `if`(has_na, length(cutoffs) - 1, -1)
    
    buckets
  }
}

#' Generates a function that will convert a character value to a bucket value
#'
#' @param values Bucket values
#' @param other_value Bucket for other values, if any
#' @param na_value Bucket for na values, if any
#'
#' @return The converter function.
#'
converter.text <- function(values, other_value = NA_character_, na_value = NA_character_) {
  
  map <- new.env(parent = emptyenv())
  
  for (i in seq_along(values)) {
    map[[values[i]]] <- i - 1
  }
  
  other <- mget(other_value, envir = map, ifnotfound = -1)
  
  function(raw) {
    if (!is.na(na_value)) {
      raw <- as.character(raw)
      
      raw[is.na(raw)] <- na_value
    }
    
    factorized <- as.factor(raw)
    
    factor_levels <- levels(factorized)
    
    levels(factorized) <- as.character(unlist(mget(factor_levels, envir = map, ifnotfound = other)))
    
    as.numeric(as.character(factorized))
  }
}

#' Generates a function that will convert a date value to a bucket value
#'
#' @param ... Arguments passed to \code{converter.text}
#' @param format Date format for date values to be converted, defaults to ISO 8601 date
#' @param bucket_format Date format for the bucket values, defaults to ISO 8601 date
#' @param tz Timezone, if any, of the date-time values, defaults to GMT
#' @param bucket_tz Timezone, if any, of the bucket values, defaults to GMT
#'
#' @return The converter function.
#'
converter.date <- function(..., format = "%F", bucket_format = "%F", tz = "GMT", bucket_tz = "GMT") {
  
  inner <- converter.text(...)
  
  if (format == bucket_format && tz == bucket_tz) {
    return(inner)
  }
  
  function(raw) {
    f <- as.factor(raw)
    
    raw_levels <- levels(f)
    
    converted_levels <- format(
      as.POSIXct(raw_levels, format = format, tz = tz),
      format = bucket_format,
      tz = bucket_tz
    )
    
    converted_levels[is.na(converted_levels)] <- raw_levels[is.na(converted_levels)]
    
    levels(f) <- converted_levels
    
    inner(as.character(f))
  }
}

#' Generates a function that will convert a date value to a bucket value
#'
#' @param data Data to be converted
#' @param converters Named list of functions that take in a vector of raw values and returns a vector bucket values
#'
#' @return The converted dataset.
#'
convert <- function(data, converters) {
  
  missing_columns <- setdiff(names(converters), names(data))
  
  if (length(missing_columns) > 0) {
    stop(paste("Missing columns:", paste(missing_columns, collapse = ", ")))
  }
  
  converted <- lapply(names(converters), function(x) { converters[[x]](data[[x]]) })
  
  names(converted) <- names(converters)
  
  for (name in names(converted)) {
    unconverted <- data[converted[[name]] == -1][[name]]
    count <- length(unconverted)
    
    if (count > 0) {
      values <- paste0(head(unconverted, 3), collapse = ", ")
      
      if (length(unconverted) > 3) {
        values <- paste0(values, ", ...")
      }
      
      fmt <- "Column: %s contains %i value%s (%s) that could not be converted These values were marked as -1."
      
      message <- sprintf(fmt, name, count, ifelse(count > 1, "s", ""), values)
      
      warning(message)
    }
  }
  
  return(converted)
}

converters <- list(
  `DAY_OF_WEEK_f` = converter.text(c("1", "2", "3", "4", "5", "6", "7"), other_value = "null", na_value = "null"),
  `MONTH_f` = converter.numeric(1, 2, 3, 5, 6, 7, 8, 9, 11, 12, has_na = FALSE),
  `AIRLINE_f` = converter.text(c("OO", "DL", "UA", "F9"), other_value = "null", na_value = "null"),
  `DESTITION_AIRPORT` = converter.text(c("SLC", "DEN", "MSP", "ORD", "SFO", "LAX", "SEA", "PDX", "ATL", "EWR", "Other"), other_value = "10", na_value = "null")
)

predict <- function(data) {
  
  predictions <- (
    -1.4193579832168868 +
      (data[[1]] == 0) * 0.2279157507701415 +
      (data[[1]] == 1) * -0.15836740388008663 +
      (data[[1]] == 2) * -0.05670108717619455 +
      (data[[1]] == 3) * -0.07459134060311348 +
      (data[[1]] == 4) * -0.1619435220669487 +
      (data[[1]] == 5) * 0.28539095339135917 +
      (data[[1]] == 6) * -0.06547789134460942 +
      (data[[1]] == 0 & data[[2]] == 0) * 0.2746631702012743 +
      (data[[1]] == 0 & data[[2]] == 1) * 0.009067225182081726 +
      (data[[1]] == 0 & data[[2]] == 2) * -0.014470697179599984 +
      (data[[1]] == 0 & data[[2]] == 3) * 0.020926982863457122 +
      (data[[1]] == 0 & data[[2]] == 4) * -0.0024046444100079955 +
      (data[[1]] == 0 & data[[2]] == 5) * -0.14011845867704617 +
      (data[[1]] == 0 & data[[2]] == 6) * -0.13160998408005056 +
      (data[[1]] == 0 & data[[2]] == 7) * -0.029497268099792025 +
      (data[[1]] == 0 & data[[2]] == 8) * 0.23991513782305565 +
      (data[[1]] == 1 & data[[2]] == 0) * -0.14902982192009914 +
      (data[[1]] == 1 & data[[2]] == 1) * 0.12718963768654182 +
      (data[[1]] == 1 & data[[2]] == 2) * -0.24247827815520773 +
      (data[[1]] == 1 & data[[2]] == 3) * -0.07545058333513624 +
      (data[[1]] == 1 & data[[2]] == 4) * -0.09643990219085 +
      (data[[1]] == 1 & data[[2]] == 5) * -0.0819600332635988 +
      (data[[1]] == 1 & data[[2]] == 6) * 0.033810271307994334 +
      (data[[1]] == 1 & data[[2]] == 7) * 0.27697166065420475 +
      (data[[1]] == 1 & data[[2]] == 8) * 0.046121576082797856 +
      (data[[1]] == 2 & data[[2]] == 0) * -0.2483126576465731 +
      (data[[1]] == 2 & data[[2]] == 1) * -0.12554356276002993 +
      (data[[1]] == 2 & data[[2]] == 2) * 0.3247096721145528 +
      (data[[1]] == 2 & data[[2]] == 3) * 0.013394571140755918 +
      (data[[1]] == 2 & data[[2]] == 4) * 0.027597906541091403 +
      (data[[1]] == 2 & data[[2]] == 5) * -0.011499355825619626 +
      (data[[1]] == 2 & data[[2]] == 6) * -0.12439940187257467 +
      (data[[1]] == 2 & data[[2]] == 7) * -0.0349875100813011 +
      (data[[1]] == 2 & data[[2]] == 8) * 0.11879239775889029 +
      (data[[1]] == 3 & data[[2]] == 0) * 0.11084101988162118 +
      (data[[1]] == 3 & data[[2]] == 1) * -0.12177257541649882 +
      (data[[1]] == 3 & data[[2]] == 2) * -0.04091637835063879 +
      (data[[1]] == 3 & data[[2]] == 3) * -0.01473989832322897 +
      (data[[1]] == 3 & data[[2]] == 4) * 0.008773177442285797 +
      (data[[1]] == 3 & data[[2]] == 5) * -0.01651876754789809 +
      (data[[1]] == 3 & data[[2]] == 6) * 0.09407837691434917 +
      (data[[1]] == 3 & data[[2]] == 7) * -0.08062182375365157 +
      (data[[1]] == 3 & data[[2]] == 8) * -0.015900844615827508 +
      (data[[1]] == 4 & data[[2]] == 0) * -0.05948819679436577 +
      (data[[1]] == 4 & data[[2]] == 1) * -0.11636057440123362 +
      (data[[1]] == 4 & data[[2]] == 2) * -0.00819179132263109 +
      (data[[1]] == 4 & data[[2]] == 3) * 0.08736595410397892 +
      (data[[1]] == 4 & data[[2]] == 4) * -0.10060315789705493 +
      (data[[1]] == 4 & data[[2]] == 5) * 0.3929177936494983 +
      (data[[1]] == 4 & data[[2]] == 6) * 0.10549530435094753 +
      (data[[1]] == 4 & data[[2]] == 7) * -0.1358520777282424 +
      (data[[1]] == 4 & data[[2]] == 8) * -0.3293622317016493 +
      (data[[1]] == 5 & data[[2]] == 0) * 0.26272975206207777 +
      (data[[1]] == 5 & data[[2]] == 1) * 0.07174192694196885 +
      (data[[1]] == 5 & data[[2]] == 2) * -0.1104995146886654 +
      (data[[1]] == 5 & data[[2]] == 3) * -1.3390391732268574E-4 +
      (data[[1]] == 5 & data[[2]] == 4) * 0.2432869995087665 +
      (data[[1]] == 5 & data[[2]] == 5) * -0.11875576690372604 +
      (data[[1]] == 5 & data[[2]] == 6) * -0.18128708172886351 +
      (data[[1]] == 5 & data[[2]] == 7) * 0.005096929972601466 +
      (data[[1]] == 5 & data[[2]] == 8) * 0.11298717086636426 +
      (data[[1]] == 6 & data[[2]] == 0) * 0.06404210466558977 +
      (data[[1]] == 6 & data[[2]] == 1) * 0.14754384008492555 +
      (data[[1]] == 6 & data[[2]] == 2) * -0.06149173722148838 +
      (data[[1]] == 6 & data[[2]] == 3) * -0.03347157069946735 +
      (data[[1]] == 6 & data[[2]] == 4) * -0.10530350798924527 +
      (data[[1]] == 6 & data[[2]] == 5) * 0.07523067398402712 +
      (data[[1]] == 6 & data[[2]] == 6) * -0.14233962279632323 +
      (data[[1]] == 6 & data[[2]] == 7) * -0.10778587565974711 +
      (data[[1]] == 6 & data[[2]] == 8) * 0.09558609445074281 +
      (data[[1]] == 0 & data[[3]] == 0) * 0.011579412845333785 +
      (data[[1]] == 0 & data[[3]] == 1) * 0.06914464405957796 +
      (data[[1]] == 0 & data[[3]] == 2) * 0.10161516366683564 +
      (data[[1]] == 0 & data[[3]] == 3) * 0.0459309021284842 +
      (data[[1]] == 1 & data[[3]] == 0) * -0.15402675339587413 +
      (data[[1]] == 1 & data[[3]] == 1) * -0.2624472689049863 +
      (data[[1]] == 1 & data[[3]] == 2) * 0.2766731999487643 +
      (data[[1]] == 1 & data[[3]] == 3) * -0.019836408845539284 +
      (data[[1]] == 2 & data[[3]] == 0) * -0.032253235992412234 +
      (data[[1]] == 2 & data[[3]] == 1) * -0.19354578699891808 +
      (data[[1]] == 2 & data[[3]] == 2) * 0.21782052070594124 +
      (data[[1]] == 2 & data[[3]] == 3) * -0.04995922651771348 +
      (data[[1]] == 3 & data[[3]] == 0) * 0.02603317887275404 +
      (data[[1]] == 3 & data[[3]] == 1) * 0.2426849642620002 +
      (data[[1]] == 3 & data[[3]] == 2) * -0.2515208772878054 +
      (data[[1]] == 3 & data[[3]] == 3) * -0.09223540440211465 +
      (data[[1]] == 4 & data[[3]] == 0) * 0.046703756477168304 +
      (data[[1]] == 4 & data[[3]] == 1) * -0.004210638535495094 +
      (data[[1]] == 4 & data[[3]] == 2) * -0.09428768167482553 +
      (data[[1]] == 4 & data[[3]] == 3) * -0.11077960805353525 +
      (data[[1]] == 5 & data[[3]] == 0) * 0.15625291477298847 +
      (data[[1]] == 5 & data[[3]] == 1) * -0.049084361327644106 +
      (data[[1]] == 5 & data[[3]] == 2) * 0.057824884574988654 +
      (data[[1]] == 5 & data[[3]] == 3) * 0.1211284401955582 +
      (data[[1]] == 6 & data[[3]] == 0) * -0.03538685182795468 +
      (data[[1]] == 6 & data[[3]] == 1) * -0.05616791875555751 +
      (data[[1]] == 6 & data[[3]] == 2) * -0.015799491622654094 +
      (data[[1]] == 6 & data[[3]] == 3) * 0.041660862912242996 +
      (data[[1]] == 0 & data[[4]] == 0) * -0.048756163574706024 +
      (data[[1]] == 0 & data[[4]] == 1) * 0.04535735773294402 +
      (data[[1]] == 0 & data[[4]] == 2) * -0.010437762799369346 +
      (data[[1]] == 0 & data[[4]] == 3) * 0.20414355794681513 +
      (data[[1]] == 0 & data[[4]] == 4) * 0.16116310094134317 +
      (data[[1]] == 0 & data[[4]] == 5) * -0.08960914834598001 +
      (data[[1]] == 0 & data[[4]] == 6) * -0.029100665132748508 +
      (data[[1]] == 0 & data[[4]] == 7) * -0.058737291070781864 +
      (data[[1]] == 0 & data[[4]] == 8) * 0.029588461602769185 +
      (data[[1]] == 0 & data[[4]] == 9) * 0.0 +
      (data[[1]] == 0 & data[[4]] == 10) * 0.02258035632378332 +
      (data[[1]] == 1 & data[[4]] == 0) * -0.09753300195210171 +
      (data[[1]] == 1 & data[[4]] == 1) * -3.1840232314572184E-4 +
      (data[[1]] == 1 & data[[4]] == 2) * 0.031211513551472028 +
      (data[[1]] == 1 & data[[4]] == 3) * -0.08191995078329706 +
      (data[[1]] == 1 & data[[4]] == 4) * 0.012863007107405603 +
      (data[[1]] == 1 & data[[4]] == 5) * 0.24348631577169438 +
      (data[[1]] == 1 & data[[4]] == 6) * -0.0770874765447534 +
      (data[[1]] == 1 & data[[4]] == 7) * -0.08574369740208604 +
      (data[[1]] == 1 & data[[4]] == 8) * -0.07557848271211805 +
      (data[[1]] == 1 & data[[4]] == 9) * 0.0 +
      (data[[1]] == 1 & data[[4]] == 10) * -0.030476188950738427 +
      (data[[1]] == 2 & data[[4]] == 0) * -0.2363186317098295 +
      (data[[1]] == 2 & data[[4]] == 1) * 0.04339259518312522 +
      (data[[1]] == 2 & data[[4]] == 2) * 0.02726278517410291 +
      (data[[1]] == 2 & data[[4]] == 3) * -0.041393770372247916 +
      (data[[1]] == 2 & data[[4]] == 4) * 0.27417045094167114 +
      (data[[1]] == 2 & data[[4]] == 5) * 0.04158422412733957 +
      (data[[1]] == 2 & data[[4]] == 6) * -0.08717515018050606 +
      (data[[1]] == 2 & data[[4]] == 7) * -0.10537044403823398 +
      (data[[1]] == 2 & data[[4]] == 8) * -0.062050038843259034 +
      (data[[1]] == 2 & data[[4]] == 9) * 0.085671259889643 +
      (data[[1]] == 2 & data[[4]] == 10) * 0.0 +
      (data[[1]] == 3 & data[[4]] == 0) * -0.24237678746113883 +
      (data[[1]] == 3 & data[[4]] == 1) * -0.035360142513563564 +
      (data[[1]] == 3 & data[[4]] == 2) * 0.05503010371408281 +
      (data[[1]] == 3 & data[[4]] == 3) * 0.04728357268107916 +
      (data[[1]] == 3 & data[[4]] == 4) * 0.20794830334804687 +
      (data[[1]] == 3 & data[[4]] == 5) * -0.0019231382328523889 +
      (data[[1]] == 3 & data[[4]] == 6) * -0.09362435705163026 +
      (data[[1]] == 3 & data[[4]] == 7) * -0.024710383499784692 +
      (data[[1]] == 3 & data[[4]] == 8) * -0.04349898464652168 +
      (data[[1]] == 3 & data[[4]] == 9) * 0.0 +
      (data[[1]] == 3 & data[[4]] == 10) * 0.054362367380365796 +
      (data[[1]] == 4 & data[[4]] == 0) * -0.012706264180017525 +
      (data[[1]] == 4 & data[[4]] == 1) * -0.03501310837129153 +
      (data[[1]] == 4 & data[[4]] == 2) * 0.051070464272303405 +
      (data[[1]] == 4 & data[[4]] == 3) * 0.012345555299097819 +
      (data[[1]] == 4 & data[[4]] == 4) * -0.19830729305561165 +
      (data[[1]] == 4 & data[[4]] == 5) * -0.08771985431161625 +
      (data[[1]] == 4 & data[[4]] == 6) * -0.08410216334085044 +
      (data[[1]] == 4 & data[[4]] == 7) * 0.05094119579547286 +
      (data[[1]] == 4 & data[[4]] == 8) * 0.03719104258325328 +
      (data[[1]] == 4 & data[[4]] == 9) * 0.0 +
      (data[[1]] == 4 & data[[4]] == 10) * 0.10209550424278126 +
      (data[[1]] == 5 & data[[4]] == 0) * 0.19496757928003594 +
      (data[[1]] == 5 & data[[4]] == 1) * -6.396165687786489E-4 +
      (data[[1]] == 5 & data[[4]] == 2) * -0.12083402725014587 +
      (data[[1]] == 5 & data[[4]] == 3) * -0.08818105260883093 +
      (data[[1]] == 5 & data[[4]] == 4) * -0.16663702007609896 +
      (data[[1]] == 5 & data[[4]] == 5) * 0.02401843621524145 +
      (data[[1]] == 5 & data[[4]] == 6) * 0.007495124881113218 +
      (data[[1]] == 5 & data[[4]] == 7) * -6.844073994088546E-4 +
      (data[[1]] == 5 & data[[4]] == 8) * 0.09210474885199287 +
      (data[[1]] == 5 & data[[4]] == 9) * 0.1574579165797561 +
      (data[[1]] == 5 & data[[4]] == 10) * 0.1861277068111707 +
      (data[[1]] == 6 & data[[4]] == 0) * -0.09843160400320132 +
      (data[[1]] == 6 & data[[4]] == 1) * -0.02454452245722692 +
      (data[[1]] == 6 & data[[4]] == 2) * -0.06821036959149701 +
      (data[[1]] == 6 & data[[4]] == 3) * 0.07413424285588632 +
      (data[[1]] == 6 & data[[4]] == 4) * 0.028835742223646703 +
      (data[[1]] == 6 & data[[4]] == 5) * 0.13667103535775424 +
      (data[[1]] == 6 & data[[4]] == 6) * -0.0844809612233947 +
      (data[[1]] == 6 & data[[4]] == 7) * -0.1085447231318502 +
      (data[[1]] == 6 & data[[4]] == 8) * 0.07289075878197639 +
      (data[[1]] == 6 & data[[4]] == 9) * -0.021975141221549456 +
      (data[[1]] == 6 & data[[4]] == 10) * 0.02561555964729626 +
      (data[[2]] == 0) * 0.2550453294803368 +
      (data[[2]] == 1) * -0.0069050419903083264 +
      (data[[2]] == 2) * -0.15147890765762773 +
      (data[[2]] == 3) * -4.924881210575493E-4 +
      (data[[2]] == 4) * -0.02293169202249045 +
      (data[[2]] == 5) * 0.10291948452284908 +
      (data[[2]] == 6) * -0.3431646180448116 +
      (data[[2]] == 7) * -0.10526581089377089 +
      (data[[2]] == 8) * 0.2700906608502563 +
      (data[[2]] == 0 & data[[3]] == 0) * 0.40842220914234145 +
      (data[[2]] == 0 & data[[3]] == 1) * 0.2050032214154947 +
      (data[[2]] == 0 & data[[3]] == 2) * -0.02699823729748891 +
      (data[[2]] == 0 & data[[3]] == 3) * -0.3315208465848462 +
      (data[[2]] == 1 & data[[3]] == 0) * 0.08668481137895424 +
      (data[[2]] == 1 & data[[3]] == 1) * -0.16547540905542224 +
      (data[[2]] == 1 & data[[3]] == 2) * -0.0792216790121517 +
      (data[[2]] == 1 & data[[3]] == 3) * 0.15034979442315208 +
      (data[[2]] == 2 & data[[3]] == 0) * 0.34358029811623 +
      (data[[2]] == 2 & data[[3]] == 1) * -0.21192751636893808 +
      (data[[2]] == 2 & data[[3]] == 2) * -0.10921312319044436 +
      (data[[2]] == 2 & data[[3]] == 3) * -0.17511840700825748 +
      (data[[2]] == 3 & data[[3]] == 0) * -0.009683183577348507 +
      (data[[2]] == 3 & data[[3]] == 1) * -0.01912701341906039 +
      (data[[2]] == 3 & data[[3]] == 2) * 0.20019259882240042 +
      (data[[2]] == 3 & data[[3]] == 3) * -0.17277335353509102 +
      (data[[2]] == 4 & data[[3]] == 0) * -0.277567616353899 +
      (data[[2]] == 4 & data[[3]] == 1) * 0.0313304263722987 +
      (data[[2]] == 4 & data[[3]] == 2) * 0.1661665932878423 +
      (data[[2]] == 4 & data[[3]] == 3) * 0.05623500418468304 +
      (data[[2]] == 5 & data[[3]] == 0) * -0.2045212903911942 +
      (data[[2]] == 5 & data[[3]] == 1) * 0.005533588228248648 +
      (data[[2]] == 5 & data[[3]] == 2) * 0.22917453655477987 +
      (data[[2]] == 5 & data[[3]] == 3) * 0.07129287172723972 +
      (data[[2]] == 6 & data[[3]] == 0) * -0.213442391254806 +
      (data[[2]] == 6 & data[[3]] == 1) * -0.18432267177327363 +
      (data[[2]] == 6 & data[[3]] == 2) * -0.025277206820324177 +
      (data[[2]] == 6 & data[[3]] == 3) * 0.07759682748505238 +
      (data[[2]] == 7 & data[[3]] == 0) * -0.08667728489000642 +
      (data[[2]] == 7 & data[[3]] == 1) * -0.14331146041149648 +
      (data[[2]] == 7 & data[[3]] == 2) * 0.04136279932768116 +
      (data[[2]] == 7 & data[[3]] == 3) * 0.08212318232915877 +
      (data[[2]] == 8 & data[[3]] == 0) * -0.031448139781430774 +
      (data[[2]] == 8 & data[[3]] == 1) * 0.22697446017486989 +
      (data[[2]] == 8 & data[[3]] == 2) * -0.10434322077985433 +
      (data[[2]] == 8 & data[[3]] == 3) * 0.1778909273678398 +
      (data[[2]] == 0 & data[[4]] == 0) * -0.19821197949311772 +
      (data[[2]] == 0 & data[[4]] == 1) * -0.09092892288796207 +
      (data[[2]] == 0 & data[[4]] == 2) * 0.15216404900776417 +
      (data[[2]] == 0 & data[[4]] == 3) * 0.2838555295803194 +
      (data[[2]] == 0 & data[[4]] == 4) * -0.07032761752277752 +
      (data[[2]] == 0 & data[[4]] == 5) * -0.2734506387669596 +
      (data[[2]] == 0 & data[[4]] == 6) * 0.03798649102858838 +
      (data[[2]] == 0 & data[[4]] == 7) * 0.0 +
      (data[[2]] == 0 & data[[4]] == 8) * -0.12808089530385966 +
      (data[[2]] == 0 & data[[4]] == 9) * 0.2213098777148962 +
      (data[[2]] == 0 & data[[4]] == 10) * 0.3203168113548968 +
      (data[[2]] == 1 & data[[4]] == 0) * -0.09881576886030546 +
      (data[[2]] == 1 & data[[4]] == 1) * -0.21936805448309254 +
      (data[[2]] == 1 & data[[4]] == 2) * 0.03576813478792324 +
      (data[[2]] == 1 & data[[4]] == 3) * 0.1498988111786426 +
      (data[[2]] == 1 & data[[4]] == 4) * 0.023355884260298866 +
      (data[[2]] == 1 & data[[4]] == 5) * 0.08669219462862027 +
      (data[[2]] == 1 & data[[4]] == 6) * -0.05395478997327294 +
      (data[[2]] == 1 & data[[4]] == 7) * 0.0 +
      (data[[2]] == 1 & data[[4]] == 8) * -0.05195034060261475 +
      (data[[2]] == 1 & data[[4]] == 9) * 0.12042721011717634 +
      (data[[2]] == 1 & data[[4]] == 10) * 0.0 +
      (data[[2]] == 2 & data[[4]] == 0) * 0.13117441399510982 +
      (data[[2]] == 2 & data[[4]] == 1) * -0.15785485157269052 +
      (data[[2]] == 2 & data[[4]] == 2) * -0.10413696340742837 +
      (data[[2]] == 2 & data[[4]] == 3) * 0.029747711684914045 +
      (data[[2]] == 2 & data[[4]] == 4) * -0.07171099361103377 +
      (data[[2]] == 2 & data[[4]] == 5) * 0.05175496118752792 +
      (data[[2]] == 2 & data[[4]] == 6) * 0.0 +
      (data[[2]] == 2 & data[[4]] == 7) * 0.0 +
      (data[[2]] == 2 & data[[4]] == 8) * 0.0 +
      (data[[2]] == 2 & data[[4]] == 9) * -0.03254887404745021 +
      (data[[2]] == 2 & data[[4]] == 10) * 0.0 +
      (data[[2]] == 3 & data[[4]] == 0) * -0.31582967150951824 +
      (data[[2]] == 3 & data[[4]] == 1) * 0.35993435453767 +
      (data[[2]] == 3 & data[[4]] == 2) * -0.09714124986421793 +
      (data[[2]] == 3 & data[[4]] == 3) * -0.061251975183752395 +
      (data[[2]] == 3 & data[[4]] == 4) * 0.05230385056485925 +
      (data[[2]] == 3 & data[[4]] == 5) * 0.034187614305084074 +
      (data[[2]] == 3 & data[[4]] == 6) * 0.0 +
      (data[[2]] == 3 & data[[4]] == 7) * -0.04548232678264324 +
      (data[[2]] == 3 & data[[4]] == 8) * 0.007281424606590621 +
      (data[[2]] == 3 & data[[4]] == 9) * 0.0 +
      (data[[2]] == 3 & data[[4]] == 10) * 0.06396603540206448 +
      (data[[2]] == 4 & data[[4]] == 0) * -0.1475114466743061 +
      (data[[2]] == 4 & data[[4]] == 1) * 0.023998383787251457 +
      (data[[2]] == 4 & data[[4]] == 2) * 0.09530238113039578 +
      (data[[2]] == 4 & data[[4]] == 3) * -0.005169858111381009 +
      (data[[2]] == 4 & data[[4]] == 4) * 0.04516455970156013 +
      (data[[2]] == 4 & data[[4]] == 5) * 0.03924789830699951 +
      (data[[2]] == 4 & data[[4]] == 6) * 0.0 +
      (data[[2]] == 4 & data[[4]] == 7) * -0.12410702421395255 +
      (data[[2]] == 4 & data[[4]] == 8) * 0.12586416116757862 +
      (data[[2]] == 4 & data[[4]] == 9) * -0.04597116146849457 +
      (data[[2]] == 4 & data[[4]] == 10) * -0.031923953195586975 +
      (data[[2]] == 5 & data[[4]] == 0) * -0.08215649488006765 +
      (data[[2]] == 5 & data[[4]] == 1) * 0.05669853229286604 +
      (data[[2]] == 5 & data[[4]] == 2) * 0.18611258845831286 +
      (data[[2]] == 5 & data[[4]] == 3) * -0.19850538190416708 +
      (data[[2]] == 5 & data[[4]] == 4) * 0.38802551901974836 +
      (data[[2]] == 5 & data[[4]] == 5) * 0.09007414428018357 +
      (data[[2]] == 5 & data[[4]] == 6) * -0.18786829250202353 +
      (data[[2]] == 5 & data[[4]] == 7) * -0.014466686296095032 +
      (data[[2]] == 5 & data[[4]] == 8) * -0.1266470479304232 +
      (data[[2]] == 5 & data[[4]] == 9) * 0.025034529405167486 +
      (data[[2]] == 5 & data[[4]] == 10) * -0.036791453668577584 +
      (data[[2]] == 6 & data[[4]] == 0) * -0.2269096219425976 +
      (data[[2]] == 6 & data[[4]] == 1) * -0.04085913617397188 +
      (data[[2]] == 6 & data[[4]] == 2) * -0.0639365178115091 +
      (data[[2]] == 6 & data[[4]] == 3) * -0.042079519573268394 +
      (data[[2]] == 6 & data[[4]] == 4) * 0.020526536167802898 +
      (data[[2]] == 6 & data[[4]] == 5) * 0.15131870885832863 +
      (data[[2]] == 6 & data[[4]] == 6) * -0.038891034501290514 +
      (data[[2]] == 6 & data[[4]] == 7) * -0.1483978409896538 +
      (data[[2]] == 6 & data[[4]] == 8) * 0.0440614890711297 +
      (data[[2]] == 6 & data[[4]] == 9) * 0.0 +
      (data[[2]] == 6 & data[[4]] == 10) * 0.0 +
      (data[[2]] == 7 & data[[4]] == 0) * 0.162420942115351 +
      (data[[2]] == 7 & data[[4]] == 1) * -0.015170177917894058 +
      (data[[2]] == 7 & data[[4]] == 2) * -0.16020468408604954 +
      (data[[2]] == 7 & data[[4]] == 3) * 0.0 +
      (data[[2]] == 7 & data[[4]] == 4) * 0.0 +
      (data[[2]] == 7 & data[[4]] == 5) * 0.0 +
      (data[[2]] == 7 & data[[4]] == 6) * -0.0933566153161412 +
      (data[[2]] == 7 & data[[4]] == 7) * 0.0 +
      (data[[2]] == 7 & data[[4]] == 8) * 0.0 +
      (data[[2]] == 7 & data[[4]] == 9) * 0.0 +
      (data[[2]] == 7 & data[[4]] == 10) * 0.0 +
      (data[[2]] == 8 & data[[4]] == 0) * 0.23501481359731516 +
      (data[[2]] == 8 & data[[4]] == 1) * 0.07566384940925404 +
      (data[[2]] == 8 & data[[4]] == 2) * -0.07849050283074742 +
      (data[[2]] == 8 & data[[4]] == 3) * -0.02997008387386734 +
      (data[[2]] == 8 & data[[4]] == 4) * -0.06711696939442757 +
      (data[[2]] == 8 & data[[4]] == 5) * 0.08667957299638698 +
      (data[[2]] == 8 & data[[4]] == 6) * -0.11137750520885367 +
      (data[[2]] == 8 & data[[4]] == 7) * 0.0 +
      (data[[2]] == 8 & data[[4]] == 8) * 0.1803191552308323 +
      (data[[2]] == 8 & data[[4]] == 9) * -0.06712719748189046 +
      (data[[2]] == 8 & data[[4]] == 10) * 0.04457526948624597 +
      (data[[3]] == 0) * 0.016443520960291093 +
      (data[[3]] == 1) * -0.25349912724991264 +
      (data[[3]] == 2) * 0.28967583065945435 +
      (data[[3]] == 3) * -0.06374053887509773 +
      (data[[3]] == 0 & data[[4]] == 0) * -0.18102394228689264 +
      (data[[3]] == 0 & data[[4]] == 1) * 0.1721467510751094 +
      (data[[3]] == 0 & data[[4]] == 2) * -0.08865583828886131 +
      (data[[3]] == 0 & data[[4]] == 3) * -0.05704657948707495 +
      (data[[3]] == 0 & data[[4]] == 4) * 0.3214265134028918 +
      (data[[3]] == 0 & data[[4]] == 5) * 0.26719747812896866 +
      (data[[3]] == 0 & data[[4]] == 6) * -0.44813241196287645 +
      (data[[3]] == 0 & data[[4]] == 7) * -0.3326033752261289 +
      (data[[3]] == 0 & data[[4]] == 8) * 0.0 +
      (data[[3]] == 0 & data[[4]] == 9) * 0.0 +
      (data[[3]] == 0 & data[[4]] == 10) * 0.36504955851422766 +
      (data[[3]] == 1 & data[[4]] == 0) * -0.3552721979131196 +
      (data[[3]] == 1 & data[[4]] == 1) * 0.0 +
      (data[[3]] == 1 & data[[4]] == 2) * 0.05604621440738277 +
      (data[[3]] == 1 & data[[4]] == 3) * 0.0 +
      (data[[3]] == 1 & data[[4]] == 4) * 0.0 +
      (data[[3]] == 1 & data[[4]] == 5) * 0.0 +
      (data[[3]] == 1 & data[[4]] == 6) * 0.0 +
      (data[[3]] == 1 & data[[4]] == 7) * 0.0 +
      (data[[3]] == 1 & data[[4]] == 8) * 0.05090006693320108 +
      (data[[3]] == 1 & data[[4]] == 9) * 0.0 +
      (data[[3]] == 1 & data[[4]] == 10) * -0.0046192986704708386 +
      (data[[3]] == 2 & data[[4]] == 0) * 0.0 +
      (data[[3]] == 2 & data[[4]] == 1) * -0.11234403733676537 +
      (data[[3]] == 2 & data[[4]] == 2) * 0.0 +
      (data[[3]] == 2 & data[[4]] == 3) * 0.1839342393312186 +
      (data[[3]] == 2 & data[[4]] == 4) * 0.0 +
      (data[[3]] == 2 & data[[4]] == 5) * 0.0 +
      (data[[3]] == 2 & data[[4]] == 6) * 0.0 +
      (data[[3]] == 2 & data[[4]] == 7) * 0.0 +
      (data[[3]] == 2 & data[[4]] == 8) * 0.0 +
      (data[[3]] == 2 & data[[4]] == 9) * 0.22114716887361277 +
      (data[[3]] == 2 & data[[4]] == 10) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 0) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 1) * -0.06370979082583218 +
      (data[[3]] == 3 & data[[4]] == 2) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 3) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 4) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 5) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 6) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 7) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 8) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 9) * 0.0 +
      (data[[3]] == 3 & data[[4]] == 10) * 0.0 +
      (data[[4]] == 0) * -0.5346100760747707 +
      (data[[4]] == 1) * -0.0044714272471997035 +
      (data[[4]] == 2) * -0.03306309358445912 +
      (data[[4]] == 3) * 0.12678884652043168 +
      (data[[4]] == 4) * 0.3210387388418753 +
      (data[[4]] == 5) * 0.2669745339786225 +
      (data[[4]] == 6) * -0.44737384672067576 +
      (data[[4]] == 7) * -0.3321125701077977 +
      (data[[4]] == 8) * 0.050922239709385274 +
      (data[[4]] == 9) * 0.22112972532945555 +
      (data[[4]] == 10) * 0.3601888475486452
  )
  
  predictions[data[[1]] == -1 | data[[2]] == -1 | data[[3]] == -1 | data[[4]] == -1] <- NA
  
  return(1 / (1 + exp(-predictions)))
}
